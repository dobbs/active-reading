<!doctype html>
<title>Identity</title>
<script type="module">
 setupNextLink()
 main()
 async function main() {
   await import("./deps/localForage-1.10.0.js")
   const store = localforage.createInstance({
     name: "fifth-random",
     storeName: "proof"
   })
   try {
     let previousWelcome = await store.getItem("greeting")
     if (!previousWelcome) {
       await store.setItem("greeting", "hello, world!")
       window.log.textContent += `welcome, first timer\n`
     } else {
       window.log.textContent += `welcome back!\n`
     }
     window.log.textContent += `[${JSON.stringify(previousWelcome,null,2)}]\n`
   } catch (error) {
     window.log.textContent += `WAT? ${error}`
   }
 }
 function setupNextLink() {
   // next step is in a different localhost subdomain but served on
   // the same port
   const link = window.next
   const url = new URL(window.location)
   url.hostname = "tree.localhost"
   url.pathname = "/tree"
   link.href= url.toString()
   link.textContent = url.toString()
 }
</script>
<p>
  The very first time you visit this page, you will be greeted as a
  first timer.  Every subsequent visit you will be welcomed back.
</p>
<pre id="log">
</pre>
<p>
  You can use the browser's developer tools to reset the
  experiment by deleting the indexed DB named "fifth-random".
</p>
<p>
  The next step in the experiment is to visit <a href="" id="next" target="_blank"></a>
</p>
